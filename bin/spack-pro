#!/usr/bin/env node

const { app, server } = require('../lib/index')
const program = require('commander')
const Logger = require('../lib/logger')
process.env.NODE_ENV = 'production'
program
  .usage('[options]')
  .option('--no-server', 'no server service')
  .option('--no-cache', 'ignore file version,rebuild all files')
  .parse(process.argv)
const logger = new Logger()
app.setCommander({
  noCache: program.cache === false
})

app.run().then(config => {
  if (program.server !== false) {
    const { port, dist } = config
    server.init({
      port,
      webroot: dist
    })
    logger.log(`server run at port ${port}`)
  }
})